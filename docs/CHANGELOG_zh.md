# 更新日志 (Changelog)

本项目的所有重大变更都将记录在此文件中。

## [v0.2.1] - 2026-01-01

### 🚀 Token 经济深度优化

此版本重点优化了 AI 加载 MCP 服务端时的上下文窗口 (Context Window) 消耗。

#### 工具定义优化 (-49% Token 消耗)
- **精雕细琢的 Schema**: 使用手动优化的 `definitions.ts` 替换了 `Zod.toJSONSchema()`。
- **移除 $schema 冗余**: 消除了每个工具定义中的 `$schema` 声明（每个工具节省约 50 字符）。
- **精简描述**: 将平均描述长度缩短了 50%。
- **隐藏内部工具**: `update_task`（标记为 `[INTERNAL]`）已从公开的 `ListTools` 中排除。

| 指标 | 优化前 | 优化后 | 提升 |
|--------|--------|-------|-------------|
| 工具定义字符数 | 10,241 | 5,237 | **-49%** |
| 预估 Token | ~2,560 | ~1,310 | **-1,250 tokens** |

#### 增量消息读取
- **已读游标表**: 新增 `read_cursors` SQLite 表，追踪每个 IDE 实例在每个会议中的最后阅读消息 ID。
- **自动增量**: `read_messages` 自动根据 `instanceId` 只返回未读消息。
- **零配置**: 无需 `afterId` 参数 — 游标完全由服务端维护。
- **响应增强**: 返回 `{ newMessages: N, messages: [...] }` 便于 AI 验证。

#### Context7 风格渐进加载
- **`get_global_topology` 升级**:
  - **默认 (列表模式)**: 返回轻量级摘要 `{ totalProjects, totalEdges, projects: [{id, name}] }`。
  - **聚焦模式**: 传入 `projectId` 获取该特定项目的详细子图。
- **`listResources` 优化**:
  - **O(1) 扩展性**: 资源列表大小现在是常量，不再随项目数量增长。
  - **静态资源**: 固定 8 个核心资源（聊天、注册表、文档、会议等）。
  - **基于模板的项目**: 不再动态列出每个项目；改用路径模板。
  - **发现流程**: AI 先读取 `hub/registry` → 发现项目 ID → 根据模板构造 URI。

| 场景 | 优化前 | 优化后 |
|----------|--------|-------|
| 0 个项目 | 8 资源 | 8 资源 + 4 模板 |
| 20 个项目 | 28 资源 | 8 资源 + 4 模板 (固定) |
| 50 个项目 | 58 资源 | 8 资源 + 4 模板 (固定) |

#### 文档
- 更新了 `README.md`，包含新的工具行为描述。
- 将 `ASSISTANT_GUIDE.md` 升级至 v0.2.1，引入“渐进式发现，增量读取”原则。
- 重新组织了 Resources 章节，采用“核心资源 + 资源模板”结构。

## [v0.2.0] - 2025-12-31

### 🚀 任务原语系统 (Phase 2 & 3)
- **异步深耕**: 关键阻塞操作 (`rename_project`, `moderator_delete_project`) 迁移至 Task 原语，支持背景级联更新。
- **可追溯性**: 所有任务现在都支持 `source_meeting_id`，将执行结果与会议决策关联。
- **进度展示**: 增加了进度追踪 (0.0-1.0) 和 `result_uri` 结构化输出。
